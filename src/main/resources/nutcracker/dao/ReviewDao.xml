<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
<mapper namespace="nutcracker.dao.ReviewDao">

  <resultMap type="hashmap"   id="map">
    <id     column="rvno"     property="reviewNo"/>
    <result column="mno"      property="memberNo"/>
    <result column="name"     property="name"/>
    <result column="path"     property="photoPath"/>
    <result column="rv_date"  property="postTime"/>
    <result column='head'     property='titleHead'/>
    <result column="title"    property="title"/>
    <result column="cont"     property="content"/>
    <result column="view_cnt" property="viewCount"/>
    <result column="hodu_cnt" property="hoduCount"/>
    
    <!-- <collection property="photoList" ofType="photo">
      <id     column="rpno"   property="photoNo"/>
      <result column="path"   property="photoPath"/>
    </collection> -->
  </resultMap>
  
  <select id="countAll" resultType="int">
    select count(*) from review;
  </select>
  
  <select id="getList" parameterType="map" resultMap="map">
    select 
      r.rvno, 
      m.name, 
      date_format(r.rv_date,'%Y-%m-%d') as rv_date, 
      r.path,
      r.head, 
      r.title, 
      ifnull(r.view_cnt, 0) as view_cnt, 
      ifnull(r.hodu_cnt, 0) as hodu_cnt
    from review r
      left outer join memb m on r.mno=m.mno
    order by r.rvno desc
    limit #{startRowIndex}, #{rowSize}
  </select>
  
  <select id='getDetail' parameterType="int" resultMap="map">
    select
		  r.rvno,
		  m.name,
		  m.path,
		  date_format(r.rv_date,'%Y-%m-%d %H:%m:%s') as rv_date,
		  r.head,
		  r.title,
		  r.cont,
		  ifnull(r.view_cnt, 0) as view_cnt, 
		  ifnull(r.hodu_cnt, 0) as hodu_cnt
		from review r
		  left outer join memb m on r.mno=m.mno
		where r.rvno=#{value}
  </select>
  
  <insert id="insert" parameterType="map">
    insert into review(rvno, rv_date,head,title,cont,mno,path) 
    values(#{reviewNo}, now(),#{titleHead},#{title},#{content},#{memberNo},#{photoPath});
  </insert>
  
  <insert id="insertPhoto" parameterType="map">
    insert into rev_phot(rvno, path)
    values
    <foreach collection="photoList" item="photo" separator=",">
      (#{reviewNo}, #{photoPath})
    </foreach>        
  </insert>
  
  <!-- <select in="count" parameterType="int" re -->
  
  
</mapper>