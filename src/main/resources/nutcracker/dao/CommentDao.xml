<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
<mapper namespace="nutcracker.dao.CommentDao">

  <resultMap type="hashmap"   id="map">
    <id     column="ctno"     property="commentNo"/>
    <result column="mno"      property="memberNo"/>
    <result column="name"     property="name"/>
    <result column="path"     property="photoPath"/>
    <result column="ct_date"  property="postTime"/>
    <result column='cont'     property='content'/>
    <result column="rep_cnt"  property="reportCount"/>
    <result column="del_yn"   property="commentDelete"/>
    <result column="botno"   property="boycottNo"/>
  </resultMap>
  
  <select id='getCommentList' parameterType="int" resultMap="map">
    select
		  cm.ctno,
		  m.mno,
		  m.name,
		  m.path,
		  cm.ct_date,
		  cm.cont,
		  cm.rep_cnt,
		  cm.del_yn
		from cmt cm, memb m
		where ctno in (select ctno from rev_cmt where rvno=#{value}) and
		  cm.mno=m.mno
  </select>
  
  <select id='getBoycottCommentList' parameterType="int" resultMap="map">
    select
      cm.ctno,
      m.mno,
      m.name,
      m.path,
      date_format(cm.ct_date,'%Y-%m-%d %T') as ct_date,
      cm.cont,
      cm.rep_cnt,
      cm.del_yn
    from cmt cm, memb m
    where ctno in (select ctno from bot_cmt where botno=#{value}) and
      cm.mno=m.mno
  </select>
  
  <select id='getBoycottCommentCount' parameterType="int" resultType="int">
    select count(*)
    from bot_cmt bc
      left outer join bot b on bc.botno = b.botno
    where b.botno=#{value}
  </select>
  
  <insert id='insertBoycottComment' parameterType="map">
    insert into cmt(
      ctno,
      mno,
      ct_date,
      cont,
      rep_cnt,
      del_yn)
    values(
      #{commentNo},
      #{memberNo},
      now(),
      #{content},
      0,
      'n')
  </insert>
  <!-- <insert id='insertBoycottCommentRel' parameterType="map">
    insert into bot_cmt(ctno,botno)
    values((select ctno from cmt where...),#{boycottNo})
  </insert> -->
  
</mapper>